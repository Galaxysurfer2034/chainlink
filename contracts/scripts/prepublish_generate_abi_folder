#!/usr/bin/env bash

# This script copies artifacts from `../artifacts/src/` and copies the production abi json files in `../abi/`
# for publishing to the @chainlink/contracts package

SCRIPTPATH="$( cd "$(dirname "$0")" >/dev/null 2>&1 ; cd .. && pwd -P )"
TARGET="abi"

# Delete existing
rm -rf $SCRIPTPATH/$TARGET && mkdir $SCRIPTPATH/$TARGET

# Delete debug files generated by hardhat
find $SCRIPTPATH/artifacts/src -type f -name "*.dbg.json" -exec rm {} \;

# For each version directory in src, create a subsequent directory in the target location
# and copy all json abi files to it
versions=( v0.4 v0.5 v0.6 v0.7 v0.8 )
for version in "${versions[@]}"
do
  mkdir $SCRIPTPATH/$TARGET/$version
  find $SCRIPTPATH/artifacts/src/$version -type f -name "*.json" -exec cp {} $SCRIPTPATH/$TARGET/$version/ \;
done