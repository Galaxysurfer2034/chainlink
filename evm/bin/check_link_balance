#!/usr/bin/env node
const abi = require('ethereumjs-abi');
const Web3 = require('web3')
const Eth = require('ethjs')

const providerURL = process.env['ETH_HTTP_URL'] || 'http://localhost:18545'
const web3 = new Web3(providerURL)
const eth = new Eth(new Eth.HttpProvider(providerURL))

if (process.argv.length < 3) {
  console.error('Usage: ./check_link_balance <token address> <holder address>')
  process.exit(1)
}

const link = process.argv[2]
const holder = process.argv[3]

const funcSelector = '0x70a08231'// "balanceOf(address)"
const encoded = abi.rawEncode(['address'], [holder])

eth.call({
  to: link,
  data: (funcSelector + encoded.toString('hex'))
}).then(hex => {
  const res = web3.utils.toBN(hex)
  if (res.length) {
    console.log(`LINK balance: ${res.toString()}`)
  } else {
    console.log(`No price listed`)
  }
})


// wallet.call({
//   to: link,
//   data: (funcSelector + encoded.toString('hex'))
// }).then(hex => {
//   const res = web3.utils.toBN(hex)
//   if (res.length) {
//     console.log(`LINK balance: ${res.toString()}`)
//   } else {
//     console.log(`No price listed`)
//   }
// })
