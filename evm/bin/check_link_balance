#!/usr/bin/env node

(async function(){

  // imports
  const ethers = require('ethers')
  const { utils } = ethers

  // ensure correct CLI ussage
  if (process.argv.length < 3) {
    console.error('Usage: ./check_link_balance <token address> <holder address>')
    process.exit(1)
  }

  const link = process.argv[2]
  const holder = process.argv[3]

  // Setup JSON RPC provider
  const providerURL = process.env['ETH_HTTP_URL'] || 'http://localhost:18545'
  const provider = new ethers.providers.JsonRpcProvider(providerURL)

  // encode function call
  const funcSelector = '0x70a08231'// "balanceOf(address)"
  const encodedParams = utils.defaultAbiCoder.encode(['address'], [holder])
  const data = utils.hexlify(utils.concat([funcSelector, encodedParams]))

  // make function call
  const hexBalance = await provider.call({
    data,
    to: link
  })
  const balance = utils.bigNumberify(hexBalance)
  console.log(`LINK balance: ${balance.toString()}`)
})()
