#!/usr/bin/env node
(async () => {
  // imports
  const { utils } = require('ethers')
  const { provider } = require('../chainlink.config')

  // ensure correct CLI ussage
  if (process.argv.length < 3) {
    console.error('Usage: ./check_link_balance <token address> <holder address>')
    process.exit(1)
  }
  const link = process.argv[2]
  const holder = process.argv[3]

  // encode function call
  const funcSelector = '0x70a08231'// "balanceOf(address)"
  const encodedParams = utils.defaultAbiCoder.encode(['address'], [holder])
  const data = utils.hexlify(utils.concat([funcSelector, encodedParams]))

  // make function call
  const hexBalance = await provider.call({
    data,
    to: link
  })
  const balance = utils.bigNumberify(hexBalance)
  console.log(`LINK balance: ${balance.toString()}`)
})()
